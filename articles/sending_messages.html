<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Sending Messages With Gmailr • gmailr</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_Pro-0.4.10/font.css" rel="stylesheet">
<link href="../deps/Source_Code_Pro-0.4.10/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Sending Messages With Gmailr">
<script src="https://cdn.jsdelivr.net/gh/posit-dev/supported-by-posit/js/badge.min.js" data-max-height="43" data-light-bg="#666f76" data-light-fg="#f9f9f9"></script><script defer data-domain="gmailr.r-lib.org,all.tidyverse.org" src="https://plausible.io/js/plausible.js"></script>
</head>
<body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-none" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">gmailr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">3.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/gmailr.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/deploy-a-token.html">Deploy a token</a></li>
    <li><a class="dropdown-item" href="../articles/oauth-client.html">Set up an OAuth client</a></li>
    <li><a class="dropdown-item" href="../articles/sending_messages.html">Sending Messages With Gmailr</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-news" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">News</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-news">
<li><h6 class="dropdown-header" data-toc-skip>Releases</h6></li>
    <li><a class="external-link dropdown-item" href="https://www.tidyverse.org/blog/2023/06/gmailr-1-0-0/">gmailr 2.0.0</a></li>
    <li><a class="external-link dropdown-item" href="https://www.tidyverse.org/articles/2019/08/gmailr-1-0-0/">gmailr 1.0.0</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../news/index.html">Changelog</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/r-lib/gmailr/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article" id="container">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Sending Messages With Gmailr</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/r-lib/gmailr/blob/v3.0.0/vignettes/sending_messages.Rmd" class="external-link"><code>vignettes/sending_messages.Rmd</code></a></small>
      <div class="d-none name"><code>sending_messages.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://gmailr.r-lib.org">gmailr</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="constructing-a-mime-message">Constructing a MIME message<a class="anchor" aria-label="anchor" href="#constructing-a-mime-message"></a>
</h2>
<div class="section level3">
<h3 id="text">Text<a class="anchor" aria-label="anchor" href="#text"></a>
</h3>
<p>First we will construct a simple text only message</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">text_msg</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gm_mime.html">gm_mime</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/accessors.html">gm_to</a></span><span class="op">(</span><span class="st">"james.f.hester@gmail.com"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/accessors.html">gm_from</a></span><span class="op">(</span><span class="st">"me@somewhere.com"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/gm_mime.html">gm_text_body</a></span><span class="op">(</span><span class="st">"Gmailr is a very handy package!"</span><span class="op">)</span></span></code></pre></div>
<p>You can convert the message to a properly formatted MIME message
using <code><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character()</a></code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/strwrap.html" class="external-link">strwrap</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">text_msg</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "MIME-Version: 1.0\r Date: Fri, 30 Jan 2026 16:12:56 GMT\r To:"    </span></span>
<span><span class="co">#&gt; [2] "james.f.hester@gmail.com\r From: me@somewhere.com\r Content-Type:"</span></span>
<span><span class="co">#&gt; [3] "multipart/mixed; boundary=c6be45eee35844e7ec1d6ada44bc15ee\r"     </span></span>
<span><span class="co">#&gt; [4] "--c6be45eee35844e7ec1d6ada44bc15ee\r MIME-Version: 1.0\r Date:"   </span></span>
<span><span class="co">#&gt; [5] "Fri, 30 Jan 2026 16:12:56 GMT\r Content-Type: text/plain;"        </span></span>
<span><span class="co">#&gt; [6] "charset=utf-8; format=flowed\r Content-Transfer-Encoding:"        </span></span>
<span><span class="co">#&gt; [7] "quoted-printable\r Gmailr is a very handy package!\r"             </span></span>
<span><span class="co">#&gt; [8] "--c6be45eee35844e7ec1d6ada44bc15ee--\r"</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="html">HTML<a class="anchor" aria-label="anchor" href="#html"></a>
</h3>
<p>You can also construct html messages. It is customary to provide a
text only message along with the html message, but with modern email
clients this is not strictly necessary.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">html_msg</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gm_mime.html">gm_mime</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/accessors.html">gm_to</a></span><span class="op">(</span><span class="st">"james.f.hester@gmail.com"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/accessors.html">gm_from</a></span><span class="op">(</span><span class="st">"me@somewhere.com"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/gm_mime.html">gm_html_body</a></span><span class="op">(</span><span class="st">"&lt;b&gt;Gmailr&lt;/b&gt; is a &lt;i&gt;very&lt;/i&gt; handy package!"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="attachments">Attachments<a class="anchor" aria-label="anchor" href="#attachments"></a>
</h3>
<p>You can add attachments to your message in two ways.</p>
<ol style="list-style-type: decimal">
<li>If the data is in a file, use <code><a href="../reference/gm_mime.html">gm_attach_file()</a></code>. The
mime type is automatically guessed by <code><a href="https://rdrr.io/pkg/mime/man/guess_type.html" class="external-link">mime::guess_type</a></code>, or
you can specify it yourself with the <code>type</code> parameter.</li>
</ol>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"iris.csv"</span>, <span class="va">iris</span><span class="op">)</span></span>
<span></span>
<span><span class="va">msg</span> <span class="op">&lt;-</span> <span class="va">html_msg</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/accessors.html">gm_subject</a></span><span class="op">(</span><span class="st">"Here are some flowers"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/gm_mime.html">gm_attach_file</a></span><span class="op">(</span><span class="st">"iris.csv"</span><span class="op">)</span></span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>If the data are already loaded into R, you can use
<code><a href="../reference/gm_mime.html">gm_attach_part()</a></code> to attach the binary data to your
file.</li>
</ol>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">msg</span> <span class="op">&lt;-</span> <span class="va">html_msg</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/gm_mime.html">gm_attach_part</a></span><span class="op">(</span>part <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rawConversion.html" class="external-link">charToRaw</a></span><span class="op">(</span><span class="st">"attach me!"</span><span class="op">)</span>, name <span class="op">=</span> <span class="st">"please"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="including-images">Including images<a class="anchor" aria-label="anchor" href="#including-images"></a>
</h3>
<p>You can also add use attached images in HTML by setting the Content
ID feature of mime emails. This can be done by referencing the image via
a <code>&lt;img src=cid:xyz&gt;</code> tag using the <code>id</code>
argument of <code>send_file()</code>. The tag value can by any unique
identifier. E.g. here is an example of including a ggplot2 image</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># First create a plot to send, and save it to mtcars.png</span></span>
<span><span class="va">mtcars</span><span class="op">$</span><span class="va">gear</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">$</span><span class="va">gear</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/grDevices/png.html" class="external-link">png</a></span><span class="op">(</span><span class="st">"mtcars.png"</span>, width <span class="op">=</span> <span class="fl">400</span>, height <span class="op">=</span> <span class="fl">400</span>, pointsize <span class="op">=</span> <span class="fl">12</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span></span>
<span>  <span class="va">mtcars</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">hp</span>,</span>
<span>    <span class="va">mpg</span>,</span>
<span>    col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">gear</span><span class="op">)</span>,</span>
<span>    pch <span class="op">=</span> <span class="fl">19</span>,</span>
<span>    xlab <span class="op">=</span> <span class="st">"Horsepower"</span>,</span>
<span>    ylab <span class="op">=</span> <span class="st">"Miles / gallon"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topright"</span>,</span>
<span>  title <span class="op">=</span> <span class="st">"# gears"</span>,</span>
<span>  pch <span class="op">=</span> <span class="fl">19</span>,</span>
<span>  col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">$</span><span class="va">gear</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">$</span><span class="va">gear</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html" class="external-link">dev.off</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; agg_png </span></span>
<span><span class="co">#&gt;       2</span></span>
<span></span>
<span><span class="co"># Next create an HTML email that references the plot as 'foobar'</span></span>
<span><span class="va">email</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gm_mime.html">gm_mime</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/accessors.html">gm_to</a></span><span class="op">(</span><span class="st">"someaddress@somewhere.com"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/accessors.html">gm_from</a></span><span class="op">(</span><span class="st">"someaddress@somewhere.com"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/accessors.html">gm_subject</a></span><span class="op">(</span><span class="st">"Cars report"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/gm_mime.html">gm_html_body</a></span><span class="op">(</span></span>
<span>    <span class="st">'&lt;h1&gt;A plot of &lt;b&gt;MotorTrend&lt;/b&gt; data &lt;i&gt;(1974)&lt;/i&gt;&lt;/h1&gt;</span></span>
<span><span class="st">    &lt;br&gt;&lt;img src="cid:foobar"&gt;'</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/gm_mime.html">gm_attach_file</a></span><span class="op">(</span><span class="st">"mtcars.png"</span>, id <span class="op">=</span> <span class="st">"foobar"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="uploading">Uploading<a class="anchor" aria-label="anchor" href="#uploading"></a>
</h2>
<div class="section level3">
<h3 id="create-draft">Create Draft<a class="anchor" aria-label="anchor" href="#create-draft"></a>
</h3>
<p>You can upload any mime message into your gmail drafts using
<code><a href="../reference/gm_create_draft.html">gm_create_draft()</a></code>. Be sure to give yourself at least
<code>compose</code> permissions first.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/gm_create_draft.html">gm_create_draft</a></span><span class="op">(</span><span class="va">file_attachment</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="insert">Insert<a class="anchor" aria-label="anchor" href="#insert"></a>
</h3>
<p>This inserts the message directly into your mailbox, bypassing
gmail’s default scanning and classification algorithms.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/gm_insert_message.html">gm_insert_message</a></span><span class="op">(</span><span class="va">file_attachment</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="import">Import<a class="anchor" aria-label="anchor" href="#import"></a>
</h3>
<p>This imports the email as though it was a normal message, with the
same scanning and classification as normal email.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/gm_import_message.html">gm_import_message</a></span><span class="op">(</span><span class="va">file_attachment</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="sending">Sending<a class="anchor" aria-label="anchor" href="#sending"></a>
</h2>
<div class="section level3">
<h3 id="draft">Draft<a class="anchor" aria-label="anchor" href="#draft"></a>
</h3>
<p><code><a href="../reference/gm_send_draft.html">gm_send_draft()</a></code> sends an email using the
<code>draft_id</code> of an existing draft (possibly created with
<code><a href="../reference/gm_create_draft.html">gm_create_draft()</a></code>).</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_drafts</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gm_drafts.html">gm_drafts</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/gm_send_draft.html">gm_send_draft</a></span><span class="op">(</span><span class="fu"><a href="../reference/gm_id.html">gm_id</a></span><span class="op">(</span><span class="va">my_drafts</span>, <span class="st">"draft_id"</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="message">Message<a class="anchor" aria-label="anchor" href="#message"></a>
</h3>
<p>You can also send an email message directly from a <code>mime</code>
object using <code><a href="../reference/gm_send_message.html">gm_send_message()</a></code>.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/gm_send_message.html">gm_send_message</a></span><span class="op">(</span><span class="va">file_attachment</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="troubleshooting">Troubleshooting<a class="anchor" aria-label="anchor" href="#troubleshooting"></a>
</h2>
<div class="section level3">
<h3 id="gmail-api-error-400-mail-service-not-enabled">Gmail API error 400: Mail service not enabled<a class="anchor" aria-label="anchor" href="#gmail-api-error-400-mail-service-not-enabled"></a>
</h3>
<p>It is possible to have a high-functioning Google account that does
not have Gmail enabled. For example, your account might be fully
operational with respect to Google Drive and yet have no mail
capabilities. Such an account cannot be used with the Gmail API and
therefore with <code>gmailr</code>. However, you will still be able to
complete the <code>gmailr</code> authorization process via
<code><a href="../reference/gm_auth.html">gm_auth()</a></code>. The problem will only reveal itself upon the
first attempt to use the API and it will look something like this:</p>
<pre><code> Error in gmailr_POST(c("messages", "send"), user_id, class = "gmail_message",  :
  Gmail API error: 400
  Mail service not enabled</code></pre>
<p>You can confirm the account’s lack of mail capability by visiting
<code>https://mail.google.com/mail/</code> while logged in. If you don’t
already have Gmail, this link gives you the option of adding mail to
your existing account or creating a new, mail-capable account.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p>Developed by <a href="https://www.jimhester.com/" class="external-link">Jim Hester</a>, <a href="https://jennybryan.org" class="external-link">Jennifer Bryan</a>, <a href="https://www.posit.co" class="external-link"><img src="https://www.tidyverse.org/posit-logo.svg" alt="Posit" height="16" width="62" style="margin-bottom: 3px;"></a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

  </div></footer>
</body>
</html>
